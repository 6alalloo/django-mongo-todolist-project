{% extends 'tasks/base.html' %}

{% block title %}Tasks{% endblock %}

{% block content %}
<h1>Tasks</h1>

{% if not user.is_authenticated %}
<p class="text-warning">
    Login to be able to see "{{ view.title|default:request.path|title }}".
</p>
<a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary">Login</a>
{% else %}
<a href="{% url 'task_create' %}" class="btn btn-success mb-3">Create New Task</a>
<ul class="list-group">
    {% for task in tasks %}
    <li class="list-group-item">
        <a href="{% url 'task_detail' task.id %}" class="text-decoration-none">
            <strong>{{ task.title }}</strong>
        </a>
        
        <!-- Department-wide task badge -->
        {% if task.is_department_task %}
        <span class="badge bg-info text-dark">Department-Wide</span>
        {% endif %}
        
        <span class="badge bg-primary">{{ task.priority }}</span>
        <span class="text-muted">Due: {{ task.due_datetime|date:"M d, Y H:i" }}</span>
        
        {% if task.user %}
        <span>Assigned to: {{ task.user.username }}</span>
        {% else %}
        <span class="text-danger">Unassigned</span>
        {% endif %}
        
        <div class="mt-2">
            <a href="{% url 'task_edit' task.id %}" class="btn btn-sm btn-warning">Edit</a>
            
            <!-- Delete button logic -->
            {% if task.can_delete %}
            <form action="{% url 'delete_task' task.id %}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
            {% endif %}
        </div>
    </li>
    {% empty %}
    <li class="list-group-item text-muted">No tasks available.</li>
    {% endfor %}
</ul>
{% endif %}
{% endblock %}
