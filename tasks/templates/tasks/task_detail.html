{% extends 'tasks/base.html' %}

{% block title %}Task Details{% endblock %}

{% block content %}   
<h1>{{ task.title }}</h1>
<p><strong>Description:</strong> {{ task.description }}</p>
<p><strong>Priority:</strong> {{ task.priority }}</p>
<p><strong>Status:</strong> {{ task.status }}</p>
<p><strong>Due Date:</strong> {{ task.due_datetime|date:"M d, Y H:i" }}</p>
<p>
    <strong>Assigned User:</strong>
    {% if task.user %}
        {{ task.user.username }}
    {% else %}
        Unassigned
    {% endif %}
</p>
<p><strong>Created At:</strong> {{ task.created_at|date:"M d, Y H:i" }}</p>
<p><strong>Last Updated:</strong> {{ task.updated_at|date:"M d, Y H:i" }}</p>

{% if task.is_department_task %}
<p class="text-info"><strong>Note:</strong> This is a department-wide task.</p>
{% endif %}

<div class="mt-3">
    <!-- Complete Task Button -->
    {% if task.status != 'Completed' %}
    <form action="{% url 'complete_task' task.id %}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to mark this task as completed?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Complete Task</button>
    </form>
    {% else %}
    <span class="text-muted">Task Completed</span>
    {% endif %}

    <!-- Back to Tasks -->
    <a href="{% url 'tasks' %}" class="btn btn-primary ms-2">Back to Tasks</a>

    <!-- Delete Button -->
    {% if can_delete %}
    <form action="{% url 'delete_task' task.id %}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this task?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger ms-2">Delete Task</button>
    </form>
    {% endif %}
</div>
{% endblock %}
